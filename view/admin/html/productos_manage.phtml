<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Administrador | Productos</title>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
  <link rel="icon" href="view/admin/img/icon.png">
  <link rel="stylesheet" type="text/css" href="../style/productos_style.css">
</head>

<body>
  <div class="container">
    <br>
    <ul class="nav nav-pills" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="pill" href="#insert">I</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="pill" href="#delete">D</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="pill" href="#promotion">P</a>
      </li>

    </ul>

    <div class="tab-content">
      <div id="insert" class="container tab-pane active"><br>
        <h3>Insertar un nuevo producto</h3>
        <form action="index.php?controller=productos&action=insert" method="post">
          <div class="row text-center">
            <div class="container tab-pane active form-group">
              <label for="form_nombre" class="font-weight-bold">Nombre</label>
              <input type="text" class="form-control col-12 font-weight-bold" name="name">
            </div>
            <div class="container tab-pane form-group">
              <label for="stock" class="font-weight-bold">Stock</label>
              <input type="text" class="form-control col-12 font-weight-bold" name="stock">
            </div>
            <div class="container tab-pane active form-group">
              <label for="price" class="font-weight-bold">Precio</label>
              <input type="text" class="form-control col-12 font-weight-bold" name="price">
            </div>
            <div class="container tab-pane active form-group">
              <label for="shrtDesc" class="font-weight-bold">Descripción corta</label>
              <textarea rows="2" class="form-control txtNoResizable" name="shortDesc"></textarea>
            </div>
            <div class="container tab-pane form-group">
              <label for="$lngDesc" class="font-weight-bold">Descripción larga</label>
              <textarea rows="5" class="form-control txtNoResizable" name="longDesc"></textarea>
            </div>
            <div class="container tab-pane active form-group">
              <label for="brand" class="font-weight-bold">Marca</label>
              <select class="form-control form-control-lg" name="brand">
              <?php
              foreach ($brands as $dato) { ?>
                <?php echo "<option value='{$dato['ID']}'>{$dato['NAME']}</option>" ?>
              <?php
              } ?>
              </select>

            </div>
            <div class="container tab-pane form-group">

              <label for="category" class="font-weight-bold">Categoría</label>
              <select class="form-control form-control-lg" name="category">
              <?php
              foreach ($categories as $dato) { ?>
                <?php echo "<option value='{$dato['ID']}'>{$dato['NAME']}</option>" ?>
              <?php   } ?>
              </select>

            </div>
            <div class="container tab-pane form-group">
              <label for="category" class="font-weight-bold">Subcategoría</label>
              <select class="form-control form-control-sm" name="subcateogry">
                  <?php
                  foreach ($subCategories as $dato) {
                    if ($dato['PARENTCATEGORY'] != NULL) { ?>
                      <?php echo "<option value='{$dato['ID']}'>{$dato['SUBCATEGORIA']}</option>" ?>
                  <?php
                  }
                   } ?>
                </select>
            </div>
            <div class="container tab-pane form-group">
              <label for="form_nombre" class="font-weight-bold">Patrocinado</label>
              <select class="form-control form-control-sm" name="sponsored">
                <?php
                $i = 0;
                foreach ($datos as $dato) { if($dato['SPONSORED'] == 'Y' || $dato['SPONSORED'] == 'N'){?>
                  <?php echo "<option value='{$dato['SPONSORED']}'>{$dato['SPONSORED']}</option>" ?>
                <?php  } }?>
              </select>
            </div>
          </div>
          <div class="form-group col-6">
            <button type="submit" class="btn btn-success font-weight-bold col-12 pt-2 pb-2" name="insert">Insertar</button>
          </div>
        </form>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addCat">+</button>
        <div class="modal fade" id="addCat">
          <form action="index.php?controller=categorias&action=insert_category" method="post">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Añadir cateogría</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                  <div class="container tab-pane active form-group">
                    <label for="nmCat" class="font-weight-bold">Nombre</label>
                    <input type="text" class="form-control col-12 font-weight-bold" name="nmCat" id="nmCat">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-outline-success">Añadir</button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div id="delete" class="container tab-pane fade"><br>
        <h3>Eliminar producto</h3>
        <form action="index.php?controller=productos&action=delete" method="post">
          <div class="row text-center">
            <table class="table table-dark table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>NOMBRE</th>
                  <th>STOCK</th>
                  <th>PRECIO</th>
                  <th>PATROCINADO</th>
                  <th>DESCRIPCIÓN CORTA</th>
                </tr>
              </thead>
              <tbody>
                <?php foreach ($datos as $dato) { ?>
                <tr>
                  <td>
                    <?php echo $dato['ID']; ?>
                  </td>
                  <td>
                    <?php echo $dato['NAME']; ?>
                  </td>
                  <td>
                    <?php echo $dato['STOCK']; ?>
                  </td>
                  <td>
                    <?php echo enEuro($dato['PRICE']); ?>
                  </td>
                  <td>
                    <?php echo $dato['SPONSORED']; ?>
                  </td>
                  <td>
                    <?php echo $dato['SHORTDESCRIPTION']; ?>
                  </td>
                  <td>
                    <?php echo "<a href=\"index.php?controller=productos&action=delete&ID={$dato['ID']}\">Borrar</a><br/>";?></td>
                </tr>
                <?php  } ?>
              </tbody>
            </table>
          </div>
        </form>
      </div>
      <div id="promotion" class="container tab-pane fade"><br>
        <h3>Crear promoción</h3>
        <form action="index.php?controller=productos&action=create_promotion" method="post">
          <div class="row text-center">
            <table class="table table-dark table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>NOMBRE</th>
                  <th>PRECIO</th>
                </tr>
              </thead>
              <tbody>
                <?php foreach ($notSponsoredPrd as $dato) {?>
                <tr>
                  <td>
                    <?php echo $dato['ID']; ?>
                  </td>
                  <td>
                    <?php echo $dato['NAME']; ?>
                  </td>
                  <td>
                    <?php echo enEuro($dato['PRICE']); ?>
                  </td>
                  <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addProm<?php echo $dato['ID']; ?>">Crear promoción</button></td>
                </tr>
                <?php }?>
              </tbody>
            </table>
          </div>
        </form>
        <?php foreach ($notSponsoredPrd as $dato) {?>
        <div id="addProm<?php echo $dato['ID']; ?>" class="modal fade">
          <form action="index.php?controller=productos&action=create_promotion&ID=<?php echo $dato['ID'];?>" method="post">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Añadir promoción - <?php echo $dato['NAME']; ?></h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                  <div class="container tab-pane active form-group">
                    <label for="prmDis" class="font-weight-bold col-12 text-center">Rango del descuento (1-99%)</label>
                    <input type="text" class="form-control font-weight-bold" name="prmDis" id="prmDis">
                  </div>
                  <div class="container tab-pane active form-inline">
                    <label for="prmyrStrt" class="font-weight-bold col-12">Fecha inicio (actual)</label>
                    <input type="text" class="form-control col-4" name="prmyrStrt" id="prmyrStrt" value="<?php echo YEAR ?>" disabled>
                    <input type="text" class="form-control col-4" name="prmmthStrt" id="prmmthStrt" value="<?php echo MONTH ?>" disabled>
                    <input type="text" class="form-control col-4" name="prmdayStrt" id="prmdayStrt" value="<?php echo DAY ?>" disabled>
                    <label for="prmyr" class="font-weight-bold col-12">Fecha final (Año-mes-día)</label>
                    <input type="text" class="form-control col-4" name="prmyr" id="prmyr" placeholder="<?php echo YEAR ?>">
                    <input type="text" class="form-control col-4" name="prmmth" id="prmmth" placeholder="<?php echo MONTH ?>">
                    <input type="text" class="form-control col-4" name="prmday" id="prmday" placeholder="<?php echo DAY+1 ?>">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-outline-success">Añadir</button>
                </div>
              </div>
            </div>
          </form>
        </div>
        <?php  } ?>
      </div>
    </div>
    <form action="index.php?controller=productos&action=show_start_page" method="post">
      <input type="submit" class="btn btn-danger" value="Página Inicio" />
    </form>
  </div>
</body>

</html>
